<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Haproxy - Tecnep</title>
<meta name="description" content="Share your ideas.">
<meta name="generator" content="Hugo 0.68.0" />
<link href="https://tecnep.comindex.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://tecnep.com/haproxy/">
<link rel="stylesheet" href="https://tecnep.com/css/theme.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="https://tecnep.com/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<script src="https://tecnep.com/js/bundle.js"></script><style>
:root {--custom-background-color: #52555B;}
</style>
<meta property="og:title" content="Haproxy" />
<meta property="og:description" content="Share your ideas." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://tecnep.com/haproxy/" />
<meta property="og:image" content="https://tecnep.com/images/og-image.png"/>
<meta property="og:site_name" content="tecnep.com" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://tecnep.com/images/og-image.png"/>

<meta name="twitter:title" content="Haproxy"/>
<meta name="twitter:description" content="Share your ideas."/>
<meta itemprop="name" content="Haproxy">
<meta itemprop="description" content="Share your ideas."></head>
<body><div class="container"><header>
<h1>Tecnep</h1>
<a href="https://github.com/pratikgautm/tecnep" class="github"><i class="fab fa-github"></i></a>
<p class="description">Share your ideas.</p>

</header>
<div class="global-menu">
<nav>
<ul>
<li><a href="/">Home</a></li>
<li><a href="/">About</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1>Haproxy</h1><p>HAProxy is a free, very fast and reliable solution offering high availability, load balancing, and proxying for TCP and HTTP-based applications. It is particularly suited for very high traffic web sites and powers quite a number of the world&rsquo;s most visited ones.
IT is reverse proxy which can route HTTP request, add modify HTTP headers, block request matching a particular pattern. It provide security to the backend servers.</p>
<h5 id="tcp-and-http-mode">TCP and HTTP mode</h5>
<p><strong>HTTP mode</strong> :</p>
<ul>
<li>does evaluate http header packet</li>
<li>for web service use this mode</li>
<li>this mode parse before forwarding them to the application server</li>
</ul>
<p><strong>TCP mode</strong></p>
<ul>
<li>doesn’t evaluate http header packet</li>
<li>for use of mail, redis server load balancing</li>
<li>this mode send raw TCP packet from client to application server.</li>
</ul>
<h5 id="supported-algorithm">Supported Algorithm</h5>
<p><em><strong>Round Robin</strong></em>
This algorithm is the most commonly implemented. It works by using each server behind the load balancer in turns, according to their weights. It’s also probably the smoothest and most fair algorithm as the servers’ processing time stays equally distributed. As a dynamic algorithm, Round Robin allows server weights to be adjusted on the go.</p>
<p><em><strong>Static Round Robin</strong></em>
Similar to Round Robin, each server is used in turns per their weights. Unlike Round Robin though, changing server weight on the fly is not an option. There are, however, no design limitations as far as the number of servers is concerned. When a server goes up, it will always be immediately reintroduced into the farm once the full map is recomputed.</p>
<p><em><strong>Least Connections</strong></em>
With this algorithm, the server with the lowest number of connections receives the connection. This type of load balancing is recommended when very long sessions are expected, such as LDAP, SQL, TSE, etc. It’s not, however, well-suited for protocols using short sessions such as HTTP. This algorithm is also dynamic like Round Robin.</p>
<p><em><strong>Source</strong></em>
This algorithm hashes the source IP and divides it by the total weight of running servers. The same client IP always reaches the same server as long as no server goes down or up. If the hash result changes due to the changing number of running servers, clients are directed to a different server. This algorithm is generally used in TCP mode where cookies cannot be inserted. It’s also static by default.</p>
<p><em><strong>URI</strong></em>
This algorithm hashes either the left part of the URI, or the whole URI and divides the hash value by the total weight of running servers. The same URI is always directed to the same server as long as no servers go up or down. It’s also a static algorithm and works the same way as the Source algorithm.</p>
<p><em><strong>URL Parameter</strong></em>
This static algorithm can only be used on an HTTP backend. The URL parameter that’s specified is looked up in the query string of each HTTP GET request. If the parameter that’s found is followed by an equal sign and value, the value is hashed and divided by the total weight of running servers.</p>
<h5 id="installation">Installation</h5>
<h5 id="configuration">Configuration</h5>
<pre><code>global
        log 127.0.0.1 local2
        log 127.0.0.1 local1 notice
        chroot /var/lib/haproxy
        user haproxy
        group haproxy
        maxconn 4096
        daemon


defaults

        log global
        mode http
        option httplog
        option dontlognull
        timeout connect 100s
        timeout client  1
        timeout server 100s


frontend main
        bind *:80
        default_backend main


backend main
        balance roundrobin
        mode http

        server user85 192.168.219.85:8080 check cookie user85
        server user94 192.168.219.94:8080 check cookie user94


#enabling stat page for graphical view  
listen stat
        bind :9000
        stats enable
        stats uri /stats
        stats auth admin:admin
</code></pre><p>Let us overview block one by one. The first block <code>global</code></p>
<h5 id="login-to-syslog">Login to syslog</h5>
<p>To see log you need to confure syslog. (Befor Haproxy 2.0)
Let us configure haproxy log to see in  <code>/var/log/haproxy</code>. Do the following two things:-</p>
<pre><code>•	configure your syslog to accept network logs - at least on localhost
•	configure haproxy to send events to 127.0.0.1 on local2/local3 or any such facility
</code></pre><p>So, your haproxy.cfgs global section would look something like:</p>
<pre><code>global
    log         127.0.0.1 local2 notice
    log         127.0.0.1 local3
</code></pre><p>While your <code>syslog.conf</code> should look like:</p>
<pre><code>local2.*        /var/log/haproxy
local3.*        /var/log/haproxy-access_log
</code></pre><p>If you use modern distro with rsyslog, then just create a file called <code>/etc/rsyslog.d/haproxy.conf</code> with following contents:</p>
<pre><code>$ModLoad imudp
$UDPServerAddress 127.0.0.1
$UDPServerRun 514

local2.*        /var/log/haproxy
local3.*        /var/log/haproxy-access_log
</code></pre><p>Restart rsyslogd and haproxy</p>
<pre><code>systemctl restart rsyslogd
systemctl restart haproxy
</code></pre><p>HAproxy ACL
<a href="https://www.haproxy.com/blog/introduction-to-haproxy-acls/">https://www.haproxy.com/blog/introduction-to-haproxy-acls/</a>
SSL
<a href="https://serversforhackers.com/c/using-ssl-certificates-with-haproxy">https://serversforhackers.com/c/using-ssl-certificates-with-haproxy</a>
Cookie in haproxy
<a href="https://www.haproxy.com/blog/load-balancing-affinity-persistence-sticky-sessions-what-you-need-to-know/">https://www.haproxy.com/blog/load-balancing-affinity-persistence-sticky-sessions-what-you-need-to-know/</a></p>
<p>Performance tuning of haproxy
<a href="https://blog.codeship.com/performance-tuning-haproxy/">https://blog.codeship.com/performance-tuning-haproxy/</a></p>
<hr>
<p>Pratik Gautam
<a href="mailto:pratikgautm@gmail.com">pratikgautm@gmail.com</a></p>
<div class="edit-meta">
<br>
<a href="https://github.com/pratikgautm/tecnep" class="edit-page"><i class="fas fa-pen-square"></i> Edit on GitHub</a>
</div><nav class="pagination"><a class="nav nav-prev" href="https://tecnep.com/nas_san/" title="NAS and SAN"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - NAS and SAN</a>
<a class="nav nav-next" href="https://tecnep.com/php_nginx_mysql/" title="Php Nginx Mysql">Next - Php Nginx Mysql <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer>
<p class="powered"> Developers <a href="https://tecnep.com"> tecnep.com </a> </p>
</footer>
</main><div class="sidebar">

<nav class="slide-menu">
<ul>
<li class=""><a href="https://tecnep.com">Home</a></li>

<li class=""><a href="https://tecnep.com/hardening/">System Hardening</a>
  
</li>

<li class=""><a href="https://tecnep.com/chrony/">NTP</a>
  
</li>

<li class=""><a href="https://tecnep.com/redis/">Redis</a>
  
</li>

<li class=" has-sub-menu"><a href="https://tecnep.com/mailcleaner/">Mailcleaner<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://tecnep.com/mailcleaner/mailcleaner_config/">MailCleaner configurations</a></li>
</ul>
  
</li>

<li class=""><a href="https://tecnep.com/kaspersky/">Kaspersky for linux</a>
  
</li>

<li class=""><a href="https://tecnep.com/snmp/">SNMP</a>
  
</li>

<li class=" has-sub-menu"><a href="https://tecnep.com/firewall/">Firewall<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://tecnep.com/firewall/firewall_keepalive/">Firewalld and keepalived</a></li>
<li class=""><a href="https://tecnep.com/firewall/rich_rule/">Rich rule</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://tecnep.com/zimbra/">Zimbra<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://tecnep.com/zimbra/zimbra_tips_tricks/">Zimbra Tips &amp; Tricks</a></li>
<li class=""><a href="https://tecnep.com/zimbra/backup/">Backup</a></li>
</ul>
  
</li>

<li class=""><a href="https://tecnep.com/glassfish/">Glassfish</a>
  
</li>

<li class=" has-sub-menu"><a href="https://tecnep.com/system_resources/">System Resources<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://tecnep.com/system_resources/increase_hd/">Increase hard disk</a></li>
</ul>
  
</li>

<li class=""><a href="https://tecnep.com/tomcat/">Tomcat</a>
  
</li>

<li class=" has-sub-menu"><a href="https://tecnep.com/dns/">DNS<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://tecnep.com/dns/spf/">SPF</a></li>
<li class=""><a href="https://tecnep.com/dns/dkim/">DKIM</a></li>
<li class=""><a href="https://tecnep.com/dns/dmarc/">DMARC</a></li>
</ul>
  
</li>

<li class=""><a href="https://tecnep.com/keepalive/">Keepalive</a>
  
</li>

<li class=""><a href="https://tecnep.com/ssl/">SSL</a>
  
</li>

<li class=""><a href="https://tecnep.com/nas_san/">NAS and SAN</a>
  
</li>

<li class="parent active"><a href="https://tecnep.com/haproxy/">Haproxy</a>
  
</li>

<li class=""><a href="https://tecnep.com/php_nginx_mysql/">Php Nginx Mysql</a>
  
</li>

<li class=""><a href="https://tecnep.com/exchnage/">Exchange</a>
  
</li>

<li class=""><a href="https://tecnep.com/samba/">Samba</a>
  
</li>

<li class=""><a href="https://tecnep.com/vmware/">Vmware</a>
  
</li>

<li class=""><a href="https://tecnep.com/mysql/">Mysql/Mariadb</a>
  
</li>
</ul>
</nav>



<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
